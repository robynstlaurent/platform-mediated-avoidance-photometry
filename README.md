# platform-mediated-avoidance-photometry
Alignment of TDT fiber photometry recordings with DeepLabCut and StateScript behavior tracking during platform-mediated avoidance procedure for mice.
Example data output, graphs, and detailed methods can be found at https://doi.org/10.1016/j.biopsych.2024.10.021

# Fiber Photometry + DeepLabCut + Behavioral State Alignment (MATLAB-based pipeline)

This repository contains a reproducible demonstration of how to integrate and analyze multimodal neuroscience data streams using MATLAB.  
It includes example code for:

- Loading and preprocessing fiber photometry data collected on TDT photometry system (https://www.tdt.com/system/fiber-photometry-system/)
- Integrating pose estimation output from DeepLabCut: Transformed from video input to csv output using Jupyter notebook and DeepLabCut trained networks
- Incorporating behavioral state information collected using StateScript from SpikeGadgets (https://spikegadgets.com/products/statescript/) 
- Aligning asynchronous data streams onto a unified timeline  
- Producing analysis-ready signals and visualizations  

---

## Project Structure
```text
photometry-video-behavior-alignment/
├── code/                     MATLAB analysis scripts
│   ├── get_fNames_AA.m       Choose cohort to analyze (list of filenames)
│   ├── TDT2MAT.m             Batch convert raw TDT to MATLAB structure
│   ├── Phot2PhotoSig.m       Batch analyze photometry signal and remove artifacts
│   ├── batch_platformTimev3.m Align timestamps across data streams
│   ├── load_AA_data.m        Loads photometry, DLC, and behavior data
│   ├── batch_TonexPhot.m     Analysis & figure generation for tone events
│   ├── batch_ShockxPhot.m    Analysis & figure generation for shock events
│   └── batch_RewardxPhot.m   Analysis & figure generation for reward events
├── data_example/             Synthetic datasets for demonstration
│   ├── fp_example.csv        Example photometry signal
│   ├── dlc_example.csv       Example DeepLabCut pose output
│   └── behavior_states.csv   Example behavioral state start/stop times
├── figures/                  Figures generated by the pipeline
│   ├── photometry_trace.png
│   ├── dlc_aligned.png
│   └── behavior_overlay.png
├── .gitignore                Specifies files Git should ignore
├── LICENSE                   MIT License
└── README.md                 Project overview and instructions


```

## Workflow
```text
        ┌───────────────────────────┐
        │      Photometry (TDT)     │
        │  → Motion artifact removal │
        │  → Isosbestic correction  │
        └────────────┬─────────────┘
                     │
                     │
        ┌────────────┴─────────────┐
        │       Video Data          │
        │  → DeepLabCut pose coords │
        │  → Operant box landmarks  │
        └────────────┬─────────────┘
                     │
                     │
        ┌────────────┴─────────────┐
        │ Microcontroller Outputs   │
        │  → Video timestamps       │
        │  → Behavioral events      │
        └────────────┬─────────────┘
                     │
                     ▼
           ┌───────────────────┐
           │  Data Alignment   │
           │ (all 3 streams)  │
           └─────────┬─────────┘
                     ▼
           ┌───────────────────┐
           │  Signal Analysis  │
           │  & Figure Output  │
           └───────────────────┘

```
## Example Output
The following figure shows the photometry signal aligned to a behavioral event, averaged across mice:
![Photometry output example](figures/Example_TonexPhot_output.png)
